<html>
    <head>
        <title>XXXX</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <style>
            h1.title {
                text-align:center;
                font-size: 3.5em;
                margin: 1em 0;
            }

            .panel-title .time {
                float: right;
            }

            .alert-no-bottom-margin {
                margin-bottom: 0;
            }

            .floating-buttons {
                position: absolute;
                bottom: 10px;
                right: 10px;
            }

            .control-label {
                margin-top: 0px;
                margin-bottom: 0px;
                padding-top: 7px;
            }
        </style>
    </head>
    <body>
        <div class="container-fluid">
            <div class="col-xs-12">
                <h1 class="title">Pladen<b>Fuld</b></h1>
            </div>
            <div class="col-xs-4">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">
                            <span>PowerUp</span>
                            <span class="time"><i class="glyphicon glyphicon-time"></i> <span data-timer="600" data-onfinish="powerup">10:00</span></span>
                        </h3>
                    </div>
                    <div class="panel-body">
                        <p>Beskrivelse her af PowerUps. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
                    </div>
                    <table class="table">
                        <tbody id="powerups">
                        </tbody>
                    </table>
                    <div class="panel-body hidden">
                        <div class="alert alert-info alert-no-bottom-margin">
                            <p>Der er ingen aktive PowerUps</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xs-4" id="teams">
            </div>
            <div class="col-xs-4">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">
                            <span>Konsekvens</span>
                            <span class="time"><i class="glyphicon glyphicon-time"></i> <span data-timer="300" data-onfinish="consequence">10:00</span></span>
                        </h3>
                    </div>
                    <div class="panel-body">
                        <p>Beskrivelse her af konsekvenser. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
                    </div>
                    <table class="table">
                            <tbody id="consequences">
                            </tbody>
                        </table>
                    <div class="panel-body hidden">
                        <div class="alert alert-info alert-no-bottom-margin">
                            <p>Der er ingen aktive konsekvenser</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="floating-buttons">
            <button class="btn btn-primary btn-block" onclick="showConsequence();"><i class="glyphicon glyphicon-screenshot"></i> Kør Konsekvens</button>
            <button class="btn btn-primary btn-block" onclick="showPowerUp();"><i class="glyphicon glyphicon-cd"></i> Kør PowerUp</button>
            <button class="btn btn-primary btn-block" onclick="showPlate();"><i class="glyphicon glyphicon-th-large"></i> Pladen fuld</button>
            <button class="btn btn-primary btn-block"><i class="glyphicon glyphicon-screenshot"></i> Giv konsekvens</button>
            <button class="btn btn-primary btn-block"><i class="glyphicon glyphicon-cd"></i> Giv powerup</button>
            <button class="btn btn-primary btn-block"  onclick="continueGame()"><i class="glyphicon glyphicon-play"></i> Continue</button>
            <button class="btn btn-primary btn-block" onclick="pauseGame()"><i class="glyphicon glyphicon-pause"></i> Pause</button>
        </div>
        <div id="modal-powerup" class="modal fade modal-powerup" tabindex="-1">
            <div class="modal-dialog modal-md">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" ><span>&times;</span></button>
                        <h4 class="modal-title">PowerUp</h4>
                    </div>
                    <div class="modal-body">
                        <div class="text-center">
                            <img src="/gfx/wheeloffortune.gif"/>
                            <div class="powerUpText">
                                <h2></h2>
                                <div class="well"></div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" data-dismiss="modal">Færdig</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="modal-consequence" class="modal fade modal-consequence" tabindex="-1">
            <div class="modal-dialog modal-md">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" ><span>&times;</span></button>
                        <h4 class="modal-title">Konsekvens</h4>
                    </div>
                    <div class="modal-body">
                        <div class="text-center">
                            <img src="/gfx/wheeloffortune.gif"/>
                            <div class="text">
                                <h2></h2>
                                <div class="well"></div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" data-dismiss="modal">Færdig</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="modal-plate" class="modal fade modal-plate" tabindex="-1">
            <div class="modal-dialog modal-md">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" ><span>&times;</span></button>
                        <h4 class="modal-title">Pladen<b>Fuld</b></h4>
                    </div>
                    <div class="modal-body">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="form-group">
                                    <div class="col-xs-4">
                                        <label class="control-label">Vælg hold</label>
                                    </div>
                                    <div class="col-xs-8">
                                        <select class="form-control" id="ModalPlateSelectedTeam"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-12">
                                    <div class="well" style="margin-top: 15px;">
                                        Alle deltagere på holdet får en power up i 10 minutter. Alle pladerne skal ryddes.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-dismiss="modal">Færdig</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="modal-challenge" class="modal fade modal-challenge" tabindex="-1">
            <div class="modal-dialog modal-md">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" ><span>&times;</span></button>
                        <h4 class="modal-title">Udfordring</b></h4>
                    </div>
                    <div class="modal-body">
                        <h2></h2>
                        <div class="well"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-dismiss="modal">Færdig</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="hidden" data-timer="1" data-onfinish="challenge"></div>
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
        <script>
            
            // TODO: Giv konsekevens til bestemt deltager
            // TODO: Giv powerup til bestemt deltager
            // TODO: Få resten af konsekvenser ind - renskriv og gør sjove + med emojies
            // TODO: Få resten af powerups ind - renskriv og gør sjove + med emojies
            // TODO: Konsekvenser og powerup hvor man kan tage fra holds plade
            // TODO: Setup hold og detalgere
            // TODO: Reset localstorage
            // TODO: Restart spil






            // Helpers
            function fancyTimeFormat(time)
            {   
                // Hours, minutes and seconds
                var hrs = ~~(time / 3600);
                var mins = ~~((time % 3600) / 60);
                var secs = ~~time % 60;

                // Output like "1:01" or "4:03:59" or "123:03:59"
                var ret = "";

                if (hrs > 0) {
                    ret += "" + hrs + ":" + (mins < 10 ? "0" : "");
                }

                ret += "" + mins + ":" + (secs < 10 ? "0" : "");
                ret += "" + secs;
                return ret;
            }

            function replaceAll(str, find, replace) {
                return str.replace(new RegExp(find, 'g'), replace);
            }

            var getRandomPowerUpTime = () => {
                return _.random(2,10); 
            }

            var getRandomConsequenceTime = () => {
                return _.random(5,15); 
            }

            var getRandomChallengeTime = () => {
                return _.random(10,30); 
            }

            var getRandomPlayerFromTeams = (teams) => {
                const players = _.chain(teams).pluck('players').flatten().value();
                return getRandomFromList(players);
            }

            var getRandomPowerUp = (powerups) => {
                return getRandomFromList(powerups);
            }
            var getRandomConsequence = (consequences) => {
                return getRandomFromList(consequences);
            }
            var getRandomChallenges = (challenges) => {
                return getRandomFromList(challenges);
            }

            var getRandomFromList = (list) => {
                return list[Math.floor(Math.random()*list.length)];
            }

            var generateDescription = (description, player, minutes) => {
                description = replaceAll(description, '{player}', player);
                description = replaceAll(description, '{minutes}', minutes || '');
                return description;
            }

            const getRandomId = () => {
                return Math.floor((1 + Math.random()) * 0x9999999999999).toString(16);
            }

            const getTimestamp = () => {
                return Math.round(Date.now()/1000);
            }


            /// Localstorage
            const LS_TEAMS = 'Teams';
            const LS_POWERUPS = 'PowerUpList';
            const LS_CONSEQUENCES = 'ConsequencesList';
            const LS_PLAYER_POWERUPS = 'PlayerPowerUpList';
            const LS_PLAYER_CONSEQUENCES = 'PlayerConsequencesList';
            const LS_POWERUP_INTERVAL = 'PowerUpInterval';
            const LS_CONSEQUENCES_INTERVAL = 'ConsequenceInterval';
            const LS_CHALLENGES = 'ChallengeList';


            var localGet = (key) => {
                return JSON.parse(localStorage.getItem(key));
            }
            var localSet = (key, value) => {
                localStorage.setItem(key, JSON.stringify(value));
            }

            var localAddItem = (key, rowId, player, duration, description) => {
                duration = (duration || 0);

                const timestamp = getTimestamp();
                var item = {
                    player: player,
                    duration: duration,
                    description: description,
                    rowId: rowId,
                    timestamp: timestamp,
                    expires: parseInt(timestamp)+parseInt(duration)
                }
                var items = localGet(key) || [];
                items.push(item);
                localSet(key, items);
            }




            // GAME SETTINGS
            var localGetPowerups = () => {
                let powers = localGet(LS_POWERUPS);
                if (!powers || powers.length === 0) {
                    powers = [{"name":"Tunge ud af munden","description":"{player} må med denne PowerUp må på et vilkårligt tidspunkt stikke tungen ud af munden. Alle deltagere skal gøre det samme. Sidste deltager til at gøre dette får en konsekvens. Når PowerUp'en er brugt, skal denne fjernes fra oversigten.","durationActive":false},{"name":"Bustur","description":"{player} må med denne PowerUp på et vilkårligt tidspunkt vælge 2 andre spillere som skal spille bustur. {player} bestemmer selv hvem der skal gi' og hvem der skal ta' imod ;-) - Når PowerUp'en er brugt, skal denne fjernes fra oversigten.","durationActive":false},{"name":"Konge","description":"{player} må med denne PowerUp bestemme XXXXXXXXX. {player} har denne PowerUp i {minutes} minutter","durationActive":true},{"name":"Superman","description":"{player} er med denne PowerUp immun overfor alt - også konger og konsekvenser! {player} har denne PowerUp i {minutes} minutter","durationActive":true}];
                    localSet(LS_POWERUPS, powers);
                }
                return powers;
            }
            var localGetConsequences = () => {
                let cons = localGet(LS_CONSEQUENCES);
                if (!cons || cons.length === 0) {
                    cons = [{"name":"Lænket makker","description":"{player} skal vælge en makker fra et andet hold. Makkeren skal lænkes med håndjern i {minutes} minutter og gøre det samme som {player}. Drikke, ryge, tisse - alt sammen.","durationActive":true},{"name":"Drik af helvedes til","description":"Førerholdet må bestemme antal tårer {player} af konsekvensen skal drikke - op til at bunde en genstand.","durationActive":false},{"name":"Hånd på ryggen","description":"{player} skal have sin primær hånd bag på ryggen i {minutes} minutter.","durationActive":true},{"name":"Bustur","description":"{player} skal have en bustur. Førerholdet må vælge hvem der skal give busturen.","durationActive":false},{"name":"Ingen tisseri mere","description":"Alle på {player}'s hold må ikke tisse i {minutes} minutter.","durationActive":true},{"name":"Drinks bytteri","description":"Alle på {player}'s hold skal bytte drinks. Førerholdet bestemmer hvem der skal have hvilke drinks.","durationActive":false},{"name":"Slave","description":"{player} skal være slave i {minutes} minutter. Alle andre deltagere må bede slaven om at hente nye provianter mv. - be creative ;-)","durationActive":true},{"name":"Svimmel.dk","description":"Alle på {player}'s skal rejse sig op og dreje 10 gange rundt!","durationActive":false},{"name":"Fars tvunget rygestop","description":"Alle på {player}'s hold må ikke ryge i {minutes} minutter!","durationActive":true}];
                    localSet(LS_CONSEQUENCES, cons);
                }
                return cons;
            }
            var localGetTeams = () => {
                let teams = localGet(LS_TEAMS);
                if (!teams || teams.length === 0) {
                    teams = [{"id":"jKLNFjlkdsfsdf", "name":"Hold 1","players":["Stefan","Andy","Stephanie"]},{"id":"FGHFDGHdfdsSs", "name":"Hold 2","players":["Dan","ElPatron","Sebastian"]}];
                    localSet(LS_TEAMS, teams);
                }
                return _.sortBy(teams, 'name');
            }
            var localGetChallenges = () => {
                let challenges = localGet(LS_CHALLENGES);
                if (!challenges || teams.length === 0) {
                    challenges = [{"id":"1", "name": "Name 1", "description": "Description of challenge 1!"},{"id":"2", "name": "Name 2", "description": "Description of challenge 2!"},{"id":"3", "name": "Name 3", "description": "Description of challenge 3!"}]
                }

                return challenges;
            }


            // GAME PLAY
            var localAddPowerup = (player, rowId, duration, description) => {
                localAddItem(LS_PLAYER_POWERUPS, rowId, player, duration, description);
            }
            var localAddConsequences = (player, rowId, duration, description) => {
                localAddItem(LS_PLAYER_CONSEQUENCES, rowId, player, duration, description);
            }
            
            var localGetCurrentPowerups = () => {
                return _.sortBy(localGet(LS_PLAYER_POWERUPS) || [], 'expires');
            }
            var localGetCurrentConsequences = () => {
                return _.sortBy(localGet(LS_PLAYER_CONSEQUENCES) || [], 'expires');
            }

            var localRemovePowerUp = (id) => {
                let powers = localGetCurrentPowerups();
                powers = _.filter(powers, (x) => { return x.rowId !== id});
                localSet(LS_PLAYER_POWERUPS, powers);
            }
            var localRemoveConsequences = (id) => {
                let cons = localGetCurrentConsequences();
                cons = _.filter(cons, (x) => { return x.rowId !== id});
                localSet(LS_PLAYER_CONSEQUENCES, cons);
            }
        </script>
        <script>
            const _powerUpInterval = localGet(LS_POWERUP_INTERVAL) || 600;
            const _consequenceInterval = localGet(LS_CONSEQUENCES_INTERVAL) || 600;
            const _teams = localGetTeams();
            const _powerups = localGetPowerups();
            const _consequences = localGetConsequences();
            const _challenges = localGetChallenges();
            let _gamePaused = false;

            // CHALLENGE
            // CHALLENGE
            // CHALLENGE
            // CHALLENGE
            // CHALLENGE
            // CHALLENGE
            const showChallenge = () => {
                $('#modal-challenge').modal('show');
            }
            $('#modal-challenge').on('show.bs.modal', function (event) {
                _gamePaused = true;
                const $modal = $(this);
                const challenge = getRandomChallenges(_challenges);

                $modal.find('h2').text(challenge.name); 
                $modal.find('.well').text(challenge.description); 
            });
            $('#modal-challenge').on('hide.bs.modal', function (event) {
                setChallengeInterval();
                _gamePaused = false;
            });
            const setChallengeInterval = () => {
                $('[data-onfinish=challenge]').data('timer', getRandomChallengeTime()*60);
            }









            // PLATE
            // PLATE
            // PLATE
            // PLATE
            // PLATE
            // PLATE
            const showPlate = () => {
                $('#modal-plate').modal('show');
            }
            $('#modal-plate').on('show.bs.modal', function (event) {
                _gamePaused = true;
                var $modal = $(this);

                $.each(_teams, (i, team) => {
                    $('#ModalPlateSelectedTeam').append(`<option value="${team.id}"> ${team.name}</option>`);
                });
            });
            $('#modal-plate').on('hide.bs.modal', function (event) {
                // Power ups durations = 10 minutes
                const chosenTeam = $('#ModalPlateSelectedTeam').val();

                const players = _.filter(_teams, (team) => {
                    return team.id == chosenTeam;
                })[0].players;

                $.each(players, (i, player) => {
                    setTimeout(() => {
                        const powerUp = getRandomPowerUp(_.filter(_powerups, (pw) => { return pw.durationActive; })); // Only take powerups that have a duration
                        givePowerup(player, powerUp.durationActive ? 600 : 0, powerUp.name);
                    }, 250);
                });

                $('#ModalPlateSelectedTeam').val('');
                $('#ModalPlateSelectedTeam').html('');
                _gamePaused = false;
            });







            // POWER UP
            // POWER UP
            // POWER UP
            // POWER UP
            // POWER UP
            // POWER UP
            const showPowerUp = () => {
                $('#modal-powerup').modal('show');
            }

            const givePowerup = (player, duration, description) => {
                const id = getRandomId();
                localAddPowerup(player, id, duration, description);
                addHtmlPowerup(player, description, duration, id);
            }

            const addHtmlPowerup = (player, description, duration, id) => {
                let $powerupItem = $('<tr><td class="player"></td><td class="powerup"></td><td class="text-right duration"><i class="glyphicon glyphicon-time"></i> <span data-timer></span></td></tr>');
                $powerupItem.find('td.player').text(player);
                $powerupItem.find('td.powerup').text(description);
                $powerupItemDuration = $powerupItem.find('td.duration');
                if (duration) {
                    $powerupItemDuration.find('[data-timer]').attr({
                        'data-timer': duration,
                        'data-id': id,
                        'data-onfinish': 'playerpowerup'
                    });
                } else {
                    let $btn = $('<button class="btn btn-danger"><i class="glyphicon glyphicon-trash"></i></button>');
                    $btn.attr('data-id', id);
                    $btn.click(() => {
                        removePlayerItem(id);
                        localRemovePowerUp(id);
                    });
                    $powerupItemDuration.html($btn);
                }

                $('#powerups').append($powerupItem);
            }

            $('#modal-powerup').on('show.bs.modal', function (event) {
                _gamePaused = true;
                var $modal = $(this);
                var $powerUpContainer = $modal.find('.powerUpText');
                $powerUpContainer.hide();

                const player = getRandomPlayerFromTeams(_teams);
                const powerUp = getRandomPowerUp(_powerups);
                let powerUpDuration = getRandomPowerUpTime();
                let powerUpDurationSec = powerUpDuration*60;

                const description = generateDescription(powerUp.description, player, powerUpDuration);

                $powerUpContainer.find('h2').text(player + ' får ' + powerUp.name);
                $powerUpContainer.find('.well').text(description);

                if (!powerUp.durationActive) powerUpDurationSec = null;
                
                setTimeout(() => {
                    $powerUpContainer.slideDown();
                    givePowerup(player, powerUpDurationSec, powerUp.name);
                }, 2000);
            })
            $('#modal-powerup').on('hide.bs.modal', function (event) {
                $('[data-onfinish=powerup]').data('timer', _powerUpInterval);
                _gamePaused = false;
            });

            const removePlayerItem = (id) => {
                $('[data-id=' + id + ']').closest('tr').remove();
            };
            
            
            
            
            
            // CONSEQUENCES
            // CONSEQUENCES
            // CONSEQUENCES
            // CONSEQUENCES
            // CONSEQUENCES
            // CONSEQUENCES
            // CONSEQUENCES


            const addHtmlConsequence = (player, description, duration, id) => {
                let $item = $('<tr><td class="player"></td><td class="description"></td><td class="text-right duration"><i class="glyphicon glyphicon-time"></i> <span data-timer></span></td></tr>');
                $item.find('td.player').text(player);
                $item.find('td.description').text(description);
                $itemDuration = $item.find('td.duration');
                if (duration) {
                    $itemDuration.find('[data-timer]').attr({
                        'data-timer': duration,
                        'data-id': id,
                        'data-onfinish': 'playerconsequence'
                    });
                    
                    $('#consequences').append($item);
                }
            }

            const showConsequence = () => {
                $('#modal-consequence').modal('show');
            }

            $('#modal-consequence').on('show.bs.modal', function (event) {
                _gamePaused = true;
                var $modal = $(this);
                var $container = $modal.find('.text');
                $container.hide();

                const player = getRandomPlayerFromTeams(_teams);
                const consequence = getRandomConsequence(_consequences);
                let duration = getRandomConsequenceTime();
                let durationSec = duration*60;

                const description = generateDescription(consequence.description, player, duration);

                $container.find('h2').text(player + ' får ' + consequence.name);
                $container.find('.well').text(description);

                if (!consequence.durationActive) durationSec = null;
                
                setTimeout(() => {
                    $container.slideDown();
                    const id = getRandomId();
                    localAddConsequences(player, id, durationSec, consequence.name);
                    addHtmlConsequence(player, consequence.name, durationSec, id);
                }, 2000);
            })
            $('#modal-consequence').on('hide.bs.modal', function (event) {
                $('[data-onfinish=consequence]').data('timer', _consequenceInterval);
                _gamePaused = false;
            });

            const timerFinished = (type, id) => {
                switch(type) {
                    case 'powerup':
                        showPowerUp();
                        break;
                    case 'consequence':
                        showConsequence();
                        break;
                    case 'playerpowerup':
                        localRemovePowerUp(id);
                        removePlayerItem(id);
                        break;
                    case 'playerconsequence':
                        localRemoveConsequences(id);
                        removePlayerItem(id);
                        break;
                    case 'challenge':
                        showChallenge();
                        break;
                }
            }

            const timerFunction = () => {
                if (_gamePaused) return;
                const $timers = $('[data-timer]');

                let currentTime;
                let $item;
                $.each($timers, (i, item) => {
                    $item = $(item);
                    currentTime = parseInt($item.data('timer'));
                    $item.data('timer', currentTime-1).text(fancyTimeFormat(currentTime));
                    if (currentTime === 0) timerFinished($item.data('onfinish'), $item.data('id'));
                });
            };

            
            $(document).ready(() => {
                setChallengeInterval();
                let timer = setInterval(timerFunction, 1000);

                const $teamContainer = $('#teams');
                $.each(_teams, (i, team) => {
                    const players = team.players;

                    const $panel = $('<div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title"></h3></div><div class="panel-body"><ol></ol></div></div>');

                    $panel.find('h3.panel-title').text(team.name);
                    $ol = $panel.find('ol');

                    $.each(players, (i, player) => {
                        $ol.append($('<li>').text(player));
                    });
                    
                    $teamContainer.append($panel);
                });

                let timestamp = getTimestamp();
                $.each(localGetCurrentConsequences(), (i, item) => {
                    if (item.expires > timestamp) {
                        addHtmlConsequence(item.player, item.description, parseInt(item.expires)-timestamp, item.rowId);
                    } else {
                        localRemoveConsequences(item.rowId);
                    }
                });
                $.each(localGetCurrentPowerups(), (i, item) => {
                    if (item.duration === 0) {
                        addHtmlPowerup(item.player, item.description, 0, item.rowId);
                    } else if (item.expires > timestamp) {
                        addHtmlPowerup(item.player, item.description, parseInt(item.expires)-timestamp, item.rowId);
                    } else {
                        localRemovePowerUp(item.rowId);
                    }
                });
            });

            const pauseGame = () => { _gamePaused = true; };
            const continueGame = () => { _gamePaused = false; };
        </script>
    </body>
</html>